<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="deploy-app" attributes="manifest">>
  <template>
    <core-ajax
      id="ajax"
      auto
      url="{{manifest}}"
      handleAs="json"
      on-core-response="{{manifestLoaded}}"
      ></core-ajax>

    <content></content>
  </template>
  <script>
    (function() {
      function capitalize(str) {
        var split = str.split(' ');
        for (var i = 0; i < split.length; i++) {
          var s = split[i];
          split[i] = s[0].toUpperCase() + s.substr(1);
        }
        return split.join(' ');
      }


      var markets = {
        "de": {
          name: "De",
          flag: "de.gif"
        },
        "fr": {
          name: "Fr",
          flag: "fr.gif"
        },
        "intl": {
          name: "Intl",
          flag: "intl.gif"
        },
        "ca": {
          name: "Ca",
          flag: "ca.gif"
        },
        "uk": {
          name: "Uk",
          flag: "uk.gif"
        },
        "us": {
          name: "Us",
          flag: "us.gif"
        }
      };


      Polymer({
        manifestLoaded: function(event) {
          var manifest = event.detail.response;

          this.setup(manifest);
        },

        setup: function(manifest) {
          var menu = this.querySelector('#configurator-type-menu');
          var mainTitle = this.querySelector('#main-title');

          // Set title
          mainTitle.innerHTML = 'Deploy - ' + manifest.version;

          var configuratorTypes = manifest.configuratorTypes;

          for (var configuratorType in configuratorTypes) {
            var menuItem = Polymer.createDOM('paper-item', capitalize(configuratorType), {
              'data-configurator': true,
              'data-type': configuratorType
            });
            menu.appendChild(menuItem);

            this.setupConfiguratorType(configuratorType, configuratorTypes[configuratorType]);
          }
        },

        setupConfiguratorType: function(type, data) {

        }
      });

    }());
  </script>
</polymer-element>